<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.eemp.modules.edu.statistics.mapper.EduInformatizationEquipInfo_8Mapper">

    <!-- 获取班级数统计 -->
    <select id="getClassNumberInfo" resultType="java.util.HashMap">
        <if test="dbType == 'mysql'">
            select chart_group, concat(year, half) as type, sum(classes_num) as value
            from
            ( edu_informatization_equip_info_8 a
            join
            ( select
            identification_code,
            date_format(fill_date, '%Y') as year,
            if(date_format(fill_date, '%m') >= 7, '下半年', '上半年') as half,
            max(fill_date) maxdate
            from edu_informatization_equip_info_8
            where fill_date &gt;= #{dayStart} and fill_date &lt; #{dayEnd}
            group by identification_code, year, half ) b
            join
            ( select
            identification_code,
            chart_group
            from organization_definition ) c
            on a.identification_code = b.identification_code and a.fill_date = b.maxdate
            and a.identification_code = c.identification_code )
            group by chart_group, year, half
        </if>
        <if test="dbType == 'h2'">
            select chart_group, concat(year, half) as type, sum(classes_num) as value
            from
            ( edu_informatization_equip_info_8 a
            join
            ( select
            identification_code,
            to_char(fill_date, 'yyyy') as year,
            case when to_char(fill_date, 'MM') >= 7 then '下半年' else '上半年' end as half,
            max(fill_date) maxdate
            from edu_informatization_equip_info_8
            where fill_date &gt;= #{dayStart} and fill_date &lt; #{dayEnd}
            group by identification_code, year, half ) b
            join
            ( select
            identification_code,
            chart_group
            from organization_definition ) c
            on a.identification_code = b.identification_code and a.fill_date = b.maxdate
            and a.identification_code = c.identification_code )
            group by chart_group, year, half
        </if>
    </select>

</mapper>